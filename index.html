<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="internet.css">
    <title>Finance Dashboard Dynamic</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="design.css">
    
    <link rel="stylesheet" href="keyboard.css">
    <script src="keyboard.js"></script>

    <script src="nguoigaccong.js"></script>
    
    <style>
        body { visibility: hidden; background-color: #000; }
        /* B√†n ph√≠m lu√¥n hi·ªÉn th·ªã ƒë∆∞·ª£c k·ªÉ c·∫£ khi body ·∫©n */
        #global-keypad-lock { visibility: visible; }
    </style>
</head>
<body data-theme="light">

    <div id="global-keypad-lock" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 99999; display: none; justify-content: center; align-items: center;">
        <div class="tech-frame-container">
            <div class="neon-frame">
                <div class="tech-details-left"><div class="tech-bar-left"></div></div>
                <div class="tech-details-right"><div class="tech-bar-right"></div></div>
            </div>

            <div class="transparent-card">
                <div class="auth-text">VUI L√íNG NH·∫¨P M·∫¨T M√É</div>
                <div class="input-display neon-display"></div>
                <div class="keypad-grid neon-grid">
                    <div class="key-btn" onclick="AuraKeypad.press(1, event)">1</div>
                    <div class="key-btn" onclick="AuraKeypad.press(2, event)">2</div>
                    <div class="key-btn" onclick="AuraKeypad.press(3, event)">3</div>
                    <div class="key-btn" onclick="AuraKeypad.press(4, event)">4</div>
                    <div class="key-btn" onclick="AuraKeypad.press(5, event)">5</div>
                    <div class="key-btn" onclick="AuraKeypad.press(6, event)">6</div>
                    <div class="key-btn" onclick="AuraKeypad.press(7, event)">7</div>
                    <div class="key-btn" onclick="AuraKeypad.press(8, event)">8</div>
                    <div class="key-btn" onclick="AuraKeypad.press(9, event)">9</div>
                    <div class="key-btn btn-cancel" onclick="AuraKeypad.clear(event)">CANCEL</div>
                    <div class="key-btn" onclick="AuraKeypad.press(0, event)">0</div>
                    <div class="key-btn btn-ok" onclick="AuraKeypad.submit(event)">ENTER</div>
                </div>
                <div style="color: var(--neon); font-size: 10px; margin-top: 20px; opacity: 0.5;">AURA SECURITY PROTOCOL</div>
            </div>
        </div>
    </div>

    <div class="wall"></div>
    <div class="floor"></div>
    <div class="tech-particles" id="particles"></div>

    <script>
        const particlesContainer = document.getElementById('particles');
        const particleCount = 40;
        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.top = Math.random() * 100 + '%';
            const moveX = (Math.random() - 0.5) * 300;
            const moveY = (Math.random() - 0.5) * 300;
            const moveZ = (Math.random() - 0.5) * 300;
            particle.style.setProperty('--px', moveX + 'px');
            particle.style.setProperty('--py', moveY + 'px');
            particle.style.setProperty('--pz', moveZ + 'px');
            particle.style.animationDelay = Math.random() * -5+ 's';
            particlesContainer.appendChild(particle);
        }
    </script>

    <div id="splash-screen">
        <div id="intro-visual" class="atomic-system">
            <div class="core-glow"></div> 
            <div class="orbit-plane plane-1"><div class="spinner spin-1"><div class="cube-wrapper"><svg class="cube-svg" viewBox="0 0 100 100"><g class="cube-line"><path d="M30 30 L70 30 L70 70 L30 70 Z" /><path d="M40 40 L60 40 L60 60 L40 60 Z" opacity="0.6" /><line x1="30" y1="30" x2="40" y2="40" /><line x1="70" y1="30" x2="60" y2="40" /><line x1="70" y1="70" x2="60" y2="60" /><line x1="30" y1="70" x2="40" y2="60" /></g></svg></div></div></div>
            <div class="orbit-plane plane-2"><div class="spinner spin-2"><div class="cube-wrapper"><svg class="cube-svg" viewBox="0 0 100 100"><g class="cube-line"><path d="M30 30 L70 30 L70 70 L30 70 Z" /><path d="M40 40 L60 40 L60 60 L40 60 Z" opacity="0.6" /><line x1="30" y1="30" x2="40" y2="40" /><line x1="70" y1="30" x2="60" y2="40" /><line x1="70" y1="70" x2="60" y2="60" /><line x1="30" y1="70" x2="40" y2="60" /></g></svg></div></div></div>
            <div class="orbit-plane plane-3"><div class="spinner spin-3"><div class="cube-wrapper"><svg class="cube-svg" viewBox="0 0 100 100"><g class="cube-line"><path d="M30 30 L70 30 L70 70 L30 70 Z" /><path d="M40 40 L60 40 L60 60 L40 60 Z" opacity="0.6" /><line x1="30" y1="30" x2="40" y2="40" /><line x1="70" y1="30" x2="60" y2="40" /><line x1="70" y1="70" x2="60" y2="60" /><line x1="30" y1="70" x2="40" y2="60" /></g></svg></div></div></div>
        </div>
        <div id="intro-ui" style="text-align: center;">
            <h1 class="neon-title">FINANCE DASHBOARD</h1>
            <p class="sub-title">System Version 8.0 | Dynamic Core</p>
            <button class="start-btn" onclick="startLoading()">Kh·ªüi ch·∫°y h·ªá th·ªëng</button>
        </div>
        <div id="loading-container">
            <div class="loader"></div>
            <p class="loading-text">LOADING CORE... <span id="load-percent">0%</span></p>
        </div>
    </div>

    <div id="screen-daily" class="screen active">
        <h2 id="display-month-title">Nh·∫≠p chi ti√™u</h2>
        <div id="daily-wallets-list"></div>
        <button class="btn btn-primary" onclick="endMonth()">K·∫æT TH√öC K·ª≤ (RESET)</button>
    </div>

    <div id="screen-budget" class="screen">
        <h2>D√≤ng ti·ªÅn & Bi·∫øn ƒë·ªông</h2>
        <div class="saving-box">
            <div class="saving-label">M·ª•c ti√™u Ti·∫øt ki·ªám (D·ª± t√≠nh)</div>
            <div class="saving-value" id="static-saving-display">0 VNƒê</div>
        </div>
        <div class="card" id="budget-details"></div>
        <div class="balance-box" id="balance-box-ui">
            <div class="balance-label">S·ªê D∆Ø TH·ª∞C T·∫æ HI·ªÜN T·∫†I</div>
            <div class="balance-value" id="actual-balance-display">0 VNƒê</div>
        </div>
    </div>

    <div id="screen-status" class="screen">
        <div id="display-area">
            <div id="visual-effect" class="effect-overlay"></div>
            <div class="hologram-info" style="bottom: -50px;">
                <div style="font-size: 12px; opacity: 0.8;">T√åNH H√åNH T√ÄI CH√çNH</div>
                <div id="hologram-percent" style="font-size: 24px; font-weight: bold; color: var(--neon-blue);">100%</div>
                <div id="hologram-status-text" style="font-size: 13px;">Tr·∫°ng th√°i</div>
            </div>
        </div>
    </div>

    <div id="screen-history" class="screen">
        <h2>L·ªãch s·ª≠</h2>
        <div id="history-list"></div>
    </div>

    <div id="screen-alloc" class="screen">
        <h2>C·∫•u h√¨nh Ng√¢n s√°ch</h2>
        <p style="color: #666; font-size: 13px;">Qu·∫£n l√Ω c√°c v√≠ chi ti√™u c·ªßa b·∫°n t·∫°i ƒë√¢y</p>
        <div class="card">
            <div class="input-group" style="border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 15px;">
                <span style="font-weight:bold; color:var(--primary); font-size: 16px;">T·ªîNG NG√ÇN S√ÅCH G·ªêC (K)</span>
                <div class="k-input-wrapper">
                    <input type="number" id="base-total-budget" style="font-weight:bold; color:var(--primary);" onchange="updateBaseTotal(this.value)">
                </div>
            </div>
            <div class="group-title" style="display:flex; justify-content:space-between; align-items:center;">
                <span>Danh s√°ch V√≠ con:</span>
                <button class="btn-mini btn-add" onclick="addNewWallet()">+ Th√™m v√≠</button>
            </div>
            <div id="alloc-wallets-container"></div>
            
            <div class="saving-preview-box">
                <div class="saving-label">Ti·∫øt ki·ªám d·ª± t√≠nh (C√≤n l·∫°i)</div>
                <div id="preview-saving-calc" class="saving-value">0</div>
            </div>

            <button class="btn btn-success" onclick="saveAllocConfig()">L∆ØU PH√ÇN B·ªî</button>
        </div>
    </div>

    <div id="screen-settings" class="screen">
        <h2>C√†i ƒë·∫∑t</h2>
        <div class="card">
            <div style="margin-bottom:10px; font-weight:bold;">T√™n th√°ng:</div>
            <input type="text" id="month-name-inp" style="text-align:left;">
            <button class="btn btn-primary" onclick="updateMonthName()">C·∫≠p nh·∫≠t t√™n</button>
        </div>
        <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
    <div>
        <b style="color: var(--neon); text-shadow: 0 0 5px var(--neon);">T√†i li·ªáu v·∫≠n h√†nh</b>
        <div style="font-size: 11px; color: var(--text-dim); margin-top: 5px; opacity: 0.7;">Xem h∆∞·ªõng d·∫´n chi ti·∫øt h·ªá th·ªëng</div>
    </div>
    <button onclick="window.location.href='huongdansudung.html'" 
            style="padding:10px 20px; border-radius:8px; border:1px solid var(--neon); background:rgba(0, 255, 136, 0.1); color:var(--neon); font-weight:bold; cursor:pointer; text-transform:uppercase;">
        M·ªü HDSD
    </button>
</div>
    </div>

    <div id="bottom-nav-bar" class="nav-container" style="justify-content: center; align-items: center; border-top: 1px solid rgba(0, 242, 255, 0.1); background: none;">
        <button onclick="window.location.href='./hologram0.html'" class="btn-hologram-back">
            <span class="btn-shell"></span>
            <span class="btn-core">‚Üê QUAY L·∫†I S·∫¢NH</span>
        </button>
    </div>

    <script src="magic.js"></script>
    <script src="logic.js"></script>

    <script>
        document.addEventListener('click', function(e) {
            
            // T√¨m Card cha
            const card = e.target.closest('.card');
            
            // Lo·∫°i tr·ª´ card kh√¥ng c·∫ßn thi·∫øt
            if (!card || card.id === 'budget-details' || card.classList.contains('history-card')) return;

            // Lo·∫°i tr·ª´ v√πng nh·∫≠p li·ªáu
            const ignoreList = ['INPUT', 'BUTTON', 'SELECT', 'TEXTAREA', 'LABEL'];
            if (ignoreList.includes(e.target.tagName)) return;

            // Logic Sticky Aura
            const isActive = card.classList.contains('is-active');
            document.querySelectorAll('.card').forEach(c => c.classList.remove('is-active'));

            if (!isActive) {
                card.classList.add('is-active');
            }
        });

        // =================================================================
        // [LOGIC KH·ªûI ƒê·ªòNG TU·∫¶N T·ª∞: ƒêEN -> B√ÄN PH√çM -> SPLASH -> DASHBOARD]
        // =================================================================
        document.addEventListener("DOMContentLoaded", function() {
            // 1. Ki·ªÉm tra Admin (Gi·ªØ nguy√™n logic c≈©)
            const expiryKey = 'AURA_EXPIRY_TIMESTAMP';
            const roleKey = 'AURA_CLEARANCE_LEVEL';
            const expiryTime = localStorage.getItem(expiryKey);
            const currentRole = localStorage.getItem(roleKey);

            if (expiryTime && currentRole && currentRole !== 'INITIATOR-0') {
                const now = new Date().getTime();
                if (now > parseInt(expiryTime)) {
                    console.warn("H·ªá th·ªëng: Quy·ªÅn h·∫°n Admin ƒë√£ h·∫øt hi·ªáu l·ª±c.");
                    localStorage.setItem(roleKey, 'INITIATOR-0');
                    localStorage.removeItem(expiryKey);
                }
            }

            // 2. KH·ªûI ƒê·ªòNG TU·∫¶N T·ª∞
            const STORAGE_PASS = "AURA_PASS_KEY"; 
            const savedPass = localStorage.getItem(STORAGE_PASS);
            const lockScreen = document.getElementById('global-keypad-lock');
            const splashScreen = document.getElementById('splash-screen');
            const navBar = document.getElementById('bottom-nav-bar');

            if (savedPass && savedPass !== "") {
                // TR∆Ø·ªúNG H·ª¢P C√ì M·∫¨T M√É:
                // Hi·ªán b√†n ph√≠m b·∫£o m·∫≠t l√™n tr∆∞·ªõc
                lockScreen.style.display = 'flex'; 
                
                // Kh·ªüi t·∫°o Keypad
                if (typeof AuraKeypad !== 'undefined') {
                    AuraKeypad.init((inputCode) => {
                        if (inputCode === savedPass) {
                            // -> NH·∫¨P ƒê√öNG M√É:
                            // 1. ·∫®n b√†n ph√≠m
                            lockScreen.style.display = 'none';
                            
                            // 2. M·ªü l·∫°i Body ƒë·ªÉ th·∫•y Splash Screen
                            document.body.style.visibility = "visible";
                            
                            // 3. ƒê·∫£m b·∫£o Splash Screen hi·ªán ra ƒë·ªÉ ng∆∞·ªùi d√πng b·∫•m "Kh·ªüi ch·∫°y"
                            if(splashScreen) splashScreen.style.display = 'flex';
                            
                            // 4. Hi·ªán Nav bar (t√πy ch·ªçn, v√¨ Splash che h·∫øt r·ªìi)
                            if(navBar) navBar.style.display = 'flex';
                            
                            console.log("üîì Access Granted! -> Chuy·ªÉn sang Splash Screen");
                        } else {
                            AuraKeypad.showError("M√É KH√îNG ƒê√öNG"); 
                        }
                    });
                }
            } else {
                // TR∆Ø·ªúNG H·ª¢P KH√îNG C√ì M·∫¨T M√É:
                // Hi·ªán ngay Body v√† Splash Screen
                document.body.style.visibility = "visible";
                lockScreen.style.display = 'none';
            }
        });
    </script>
    <script src="internet.js"></script>
    <script src="aura_assistant.js"></script>
    <script>
        // L·∫Øng nghe v√† ghi ƒë√® s·ª± ki·ªán chuy·ªÉn tab ƒë·ªÉ g·ªçi tr·ª£ l√Ω
        if (typeof tab === 'function') {
            const originalTab = tab; // L∆∞u l·∫°i logic chuy·ªÉn tab g·ªëc
            tab = function(id) {
                originalTab(id); // Ch·∫°y giao di·ªán tab nh∆∞ b√¨nh th∆∞·ªùng
                
                // G·ªçi Tr·ª£ l√Ω v·ªõi ID t∆∞∆°ng ·ª©ng (vd: 'task_daily', 'task_budget'...)
                if (typeof initAuraAssistant === 'function') {
                    // ƒê·ª£i giao di·ªán render xong (300ms) r·ªìi m·ªõi bung tr·ª£ l√Ω ƒë·ªÉ t·∫°o c·∫£m gi√°c m∆∞·ª£t
                    setTimeout(() => {
                        initAuraAssistant('task_' + id);
                    }, 300);
                }
            };
        }

        // K√≠ch ho·∫°t ngay l·∫ßn ƒë·∫ßu ti√™n m·ªü file (d·ª±a tr√™n tab m·∫∑c ƒë·ªãnh ƒëang m·ªü)
        window.addEventListener('load', () => {
            const params = new URLSearchParams(window.location.search);
            const targetTask = params.get('task') || 'daily';
            
            // ƒê·ª£i Splash Screen ch·∫°y xong (t√πy ch·ªânh th·ªùi gian n·ªÅu c·∫ßn)
            setTimeout(() => {
                if (typeof initAuraAssistant === 'function') {
                    initAuraAssistant('task_' + targetTask);
                }
            }, 500);
        });
    </script>
</body>
</html>
